function weekdayNameToMomentId(e){return"monday"==e.toLowerCase()?1:"tuesday"==e.toLowerCase()?2:"wednesday"==e.toLowerCase()?3:"thursday"==e.toLowerCase()?4:"friday"==e.toLowerCase()?5:"saturday"==e.toLowerCase()?6:"sunday"==e.toLowerCase()?0:void 0}var GOOGLE_CALENDAR_CLIENT_ID="92861593872-j6vjdjh4cjrpg67u0hgrdpvtl5cm1t7a.apps.googleusercontent.com",GOOGLE_CALENDAR_SCOPES=["https://www.googleapis.com/auth/calendar"],weekdays=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];angular.module("AnimeKoyomi",["ngMaterial"]).controller("HorribleSubsController",["$scope","$rootScope","$log","$http",function(e,t,o,n){o.log("HorribleSubs Controller started."),e.timezone="America/Los_Angeles",e.items=[],t.horribleSubsItems=e.items,e.nextWeekday=function(e){var t=moment().day(e);return t.unix()<moment().unix()&&t.add(7,"days"),t},e.getRemoteItems=function(){n({url:"/schedule/horriblesubs",method:"GET"}).success(function(o,n,a,r){for(var i=0;i<o.length;i++){var s=o[i],m=weekdayNameToMomentId(s.weekday),l=e.nextWeekday(m),u=moment.tz({year:l.year(),month:l.month(),day:l.date(),hour:s.time.hour,minute:s.time.minute},e.timezone),c=u.tz(t.userTimezone),d=moment.tz({hour:c.hour(),minute:c.minute()},t.userTimezone),h={weekday:c.day(),title:s.seriesName,id:s.seriesId,time:u,convertedTime:c,selected:!1,timestamp:d.unix()};e.items.push(h)}}).error(function(t,o,n,a){e.status=o}),console.log(e.items)},e.recalculateTimes=function(o){for(var n=0;n<e.items.length;n++){var a=e.items[n].time.tz(t.userTimezone),r=moment.tz({hour:a.hour(),minute:a.minute()},t.userTimezone);e.items[n].convertedTime=a,e.items[n].weekday=a.day(),e.items[n].timestamp=r.unix()}},e.getRemoteItems(),e.$watch("userTimezone",function(){e.recalculateTimes(t.userTimezone)})}]).controller("SenpaiController",["$scope","$rootScope","$log","$http",function(e,t,o,n){o.log("Senpai Controller started."),e.timezone="Europe/London",e.items=[],t.senpaiItems=e.items,e.nextWeekday=function(e){var t=moment().day(e);return t.unix()<moment().unix()&&t.add(7,"days"),t},e.getRemoteItems=function(){n({url:"/schedule/senpai",method:"GET"}).success(function(o,n,a,r){for(var i=0;i<o.length;i++){var s=o[i],m=weekdayNameToMomentId(s.weekday),l=e.nextWeekday(m),u=moment.tz({year:l.year(),month:l.month(),day:l.date(),hour:s.time.hour,minute:s.time.minute},e.timezone),c=u.tz(t.userTimezone),d=moment.tz({hour:c.hour(),minute:c.minute()},t.userTimezone),h={weekday:c.day(),title:s.seriesName,id:s.seriesId,time:u,convertedTime:c,selected:!1,timestamp:d.unix()};e.items.push(h)}}).error(function(t,o,n,a){e.status=o}),console.log(e.items)},e.recalculateTimes=function(o){for(var n=0;n<e.items.length;n++){var a=e.items[n].time.tz(t.userTimezone),r=moment.tz({hour:a.hour(),minute:a.minute()},t.userTimezone);e.items[n].convertedTime=a,e.items[n].weekday=a.day(),e.items[n].timestamp=r.unix()}},e.getRemoteItems(),e.$watch("userTimezone",function(){e.recalculateTimes(t.userTimezone)})}]).controller("CrunchyrollController",["$scope","$rootScope","$log","$http",function(e,t,o,n){o.log("Crunchyroll Controller started."),e.timezone="US/Pacific",e.items=[],t.crunchyrollItems=e.items,e.nextWeekday=function(e){var t=moment().day(e);return t.unix()<moment().unix()&&t.add(7,"days"),t},e.getRemoteItems=function(){n({url:"/schedule/crunchyroll",method:"GET"}).success(function(o,n,a,r){for(var i=0;i<o.length;i++){var s=o[i],m=weekdayNameToMomentId(s.weekday),l=e.nextWeekday(m),u=moment.tz({year:l.year(),month:l.month(),day:l.date(),hour:s.time.hour,minute:s.time.minute},e.timezone),c=u.tz(t.userTimezone),d=moment.tz({hour:c.hour(),minute:c.minute()},t.userTimezone),h={weekday:c.day(),title:s.seriesName,id:s.seriesId,time:u,convertedTime:c,selected:!1,timestamp:d.unix()};e.items.push(h)}}).error(function(t,o,n,a){e.status=o}),console.log(e.items)},e.recalculateTimes=function(o){for(var n=0;n<e.items.length;n++){var a=e.items[n].time.tz(t.userTimezone),r=moment.tz({hour:a.hour(),minute:a.minute()},t.userTimezone);e.items[n].convertedTime=a,e.items[n].weekday=a.day(),e.items[n].timestamp=r.unix()}},e.getRemoteItems(),e.$watch("userTimezone",function(){e.recalculateTimes(t.userTimezone)})}]).controller("ConfigPanelController",["$scope","$rootScope","$log","$timeout","$mdDialog",function(e,t,o,n,a){e.googleAuthorized=!1,e.calendarList=[],e.newCalendar=!1,e.allTimezones=moment.tz.names(),t.userTimezone=moment.tz.guess(),console.log("Guessed timezone: "+t.userTimezone),e.customTimezone="",e.$watch("customTimezone",function(){""!=e.customTimezone&&(console.log("User selected custom timezone: "+e.customTimezone.trim()),t.userTimezone=e.customTimezone.trim())}),e.googleLoginClick=function(){e.handleAuthClick()},e.handleAuthClick=function(){return n(function(){gapi.auth.authorize({client_id:GOOGLE_CALENDAR_CLIENT_ID,scope:GOOGLE_CALENDAR_SCOPES,immediate:!1},function(t){n(function(){e.handleAuthResult(t)},0)})},0),!1},e.handleAuthResult=function(t){t&&!t.error?(e.loadCalendarApi(),console.log("User successfuly authorized.")):(console.log("User isn't authorized."),e.googleAuthorized=!1)},e.loadCalendarApi=function(){gapi.client.load("calendar","v3",function(){n(function(){e.onApiLoaded()},0)})},e.onApiLoaded=function(){e.googleAuthorized=!0,o.log("Calendar API loaded!"),e.getCalendars()},e.getCalendars=function(){var t=gapi.client.calendar.calendarList.list();t.execute(function(t){n(function(){var o=t.items;o.unshift({summary:"[New Calendar]"}),console.log(o),e.calendarList=o},0)})},e.clearCalendar=function(e){console.log("Clearing calendar with id "+e);var t=gapi.client.calendar.events.list({calendarId:e});t.execute(function(t){n(function(){console.log(t);for(var o=t.items,n=0;n<o.length;n++){var a=o[n].id,r=gapi.client.calendar.events["delete"]({calendarId:e,eventId:a});r.execute()}},0)})},e.addCalendarItem=function(e,o){var n=e.convertedTime,a=n.clone().add(30,"minutes"),r=gapi.client.calendar.events.insert({start:{dateTime:n.format(),timeZone:t.userTimezone},end:{dateTime:a.format(),timeZone:t.userTimezone},calendarId:o,summary:e.title,recurrence:["RRULE:FREQ=WEEKLY"]});r.execute()},e.createEvents=function(){console.log(e.selectedCalendar);var o=e.selectedCalendar.trim(),a="";if(console.log("HorribleSubs array:"),console.log(t.horribleSubsItems),console.log("Senpai array:"),console.log(t.senpaiItems),console.log("CR array:"),console.log(t.crunchyrollItems),e.newCalendar)a=""!=e.newCalendarTitle.trim()?e.createCalendar(e.newCalendarTitle):e.createCalendar("Anime Koyomi");else for(var r=0;r<e.calendarList.length;r++)if(console.log("Checking "+e.calendarList[r].summary+" against "+o),e.calendarList[r].summary==o){a=e.calendarList[r].id;break}e.clearCalendar(a);for(var i=[],r=0;r<t.horribleSubsItems.length;r++)t.horribleSubsItems[r].selected&&i.push(t.horribleSubsItems[r]);for(var r=0;r<t.senpaiItems.length;r++)t.senpaiItems[r].selected&&i.push(t.senpaiItems[r]);for(var r=0;r<t.crunchyrollItems.length;r++)t.crunchyrollItems[r].selected&&i.push(t.crunchyrollItems[r]);console.log(i);for(var r=0;r<i.length;r++)e.addCalendarItem(i[r],a);n(function(){e.showFinalDialog(!0)},1e3)},e.createCalendar=function(e){var t=gapi.client.calendar.calendars.insert({summary:e,description:"Calendar created by Anime Koyomi."});t.execute(function(e){n(function(){e.id},0)})},e.showFinalDialog=function(e){var t=(a.alert().title("Events created!").textContent("Visit Google Calendar to see your new events: <br/><br/>http://calendar.google.com/").clickOutsideToClose(!0),a.alert().title("Error").textContent("Something went wrong.").clickOutsideToClose(!0).ok("Got it!"));e?a.show({clickOutsideToClose:!0,template:'<md-dialog>  <md-dialog-content>   <h2 class="md-title ng-binding">Events created successfully!</h2>   You can visit Google Calendar now to see the new events.  </md-dialog-content>  <md-dialog-actions>    <md-button href="http://calendar.google.com/" class="md-primary">      Go to Google Calendar    </md-button>  </md-dialog-actions></md-dialog>'}):a.show(t)},e.$watch("selectedCalendar",function(){var t=e.selectedCalendar.trim();"[New Calendar]"==t&&(e.newCalendar=!0)})}]).filter("twodigits",function(){return function(e){return 10>e&&(e="0"+e),e}});